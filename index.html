<!-- index.html -->
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendario Cute</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <nav class="dropdown-menu">
    <button class="menu-button">Menu ▼</button>
    <ul class="menu-list">
      <li class="menu-item" id="login-button">Login</li>
    </ul>
  </nav>

  <div class="calendar-container">
    <div class="calendar-header">
      <button id="prev-month">&#8592;</button>
      <h2 id="month-year"></h2>
      <button id="next-month">&#8594;</button>
    </div>
    <table class="calendar">
      <thead>
        <tr id="day-names"></tr>
      </thead>
      <tbody id="calendar-body"></tbody>
    </table>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = { apiKey: "AIzaSyBTc-IEX2IlfQXwL2n-r-lbWepxys0dEco", authDomain: "prenotazioni-app-87467.firebaseapp.com", projectId: "prenotazioni-app-87467", storageBucket: "prenotazioni-app-87467.firebasestorage.app", messagingSenderId: "322391103742", appId: "1:322391103742:web:6f74e033b57281bdaaedaf" };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth(); const db = firebase.firestore();

    // Calendar functions
    function calculateEaster(year){const a=year%19,b=Math.floor(year/100),c=year%100,d=Math.floor(b/4),e=b%4,f=Math.floor((b+8)/25),g=Math.floor((b-f+1)/3),h=(19*a+b-d-g+15)%30,i=Math.floor(c/4),k=c%4,L=(32+2*e+2*i-h-k)%7,m=Math.floor((a+11*h+22*L)/451),month=Math.floor((h+L-7*m+114)/31),day=((h+L-7*m+114)%31)+1;return new Date(year,month-1,day);}    
    function getItalianHolidays(year){const easter=calculateEaster(year),easterMonday=new Date(easter);easterMonday.setDate(easter.getDate()+1);const fixed=[new Date(year,0,1),new Date(year,0,6),new Date(year,3,25),new Date(year,4,1),new Date(year,5,2),new Date(year,7,15),new Date(year,10,1),new Date(year,11,8),new Date(year,11,25),new Date(year,11,26)];return [easter,easterMonday,...fixed].map(d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`);}    
    function renderCalendar(prefix){const today=prefix?window[prefix+'Date']:window.calendarDate,year=today.getFullYear(),month=today.getMonth(),holidays=getItalianHolidays(year);let monthName=today.toLocaleString('it-IT',{month:'long'});monthName=monthName.charAt(0).toUpperCase()+monthName.slice(1);document.getElementById(prefix+'month-year').textContent=`${monthName} ${year}`;const names=['Lunedì','Martedì','Mercoledì','Giovedì','Venerdì','Sabato','Domenica'],head=document.getElementById(prefix+'day-names');head.innerHTML='';names.forEach(n=>{const th=document.createElement('th');th.textContent=n;head.appendChild(th);});const firstDay=new Date(year,month,1),start=(firstDay.getDay()+6)%7,daysInMonth=new Date(year,month+1,0).getDate(),total=start+daysInMonth,rows=Math.ceil(total/7),body=document.getElementById(prefix+'calendar-body');body.innerHTML='';let date=1;for(let i=0;i<rows;i++){const row=document.createElement('tr');for(let j=0;j<7;j++){const cell=document.createElement('td'),idx=i*7+j;if(idx<start||date>daysInMonth){cell.textContent='';}else{const ds=`${year}-${String(month+1).padStart(2,'0')}-${String(date).padStart(2,'0')}`;cell.textContent=date;if(j===6)cell.classList.add('sunday');if(holidays.includes(ds))cell.classList.add('holiday');date++;}row.appendChild(cell);}body.appendChild(row);}    }

    // State
    window.calendarDate=new Date(); window.calendar2Date=new Date();
    document.getElementById('prev-month').addEventListener('click',()=>{calendarDate.setMonth(calendarDate.getMonth()-1);renderCalendar('');});
    document.getElementById('next-month').addEventListener('click',()=>{calendarDate.setMonth(calendarDate.getMonth()+1);renderCalendar('');});

    // Login
    document.getElementById('login-button').addEventListener('click',async()=>{try{const email=prompt('Email:'),pass=prompt('Password:'),uc=await auth.signInWithEmailAndPassword(email,pass),user=uc.user,doc=await db.collection('admins').doc(user.uid).get();if(doc.exists)window.location.href='gestione.html';else{alert('Non autorizzato');await auth.signOut();}}catch(e){alert(e.message);}});

    renderCalendar('');
  </script>

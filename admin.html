<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Gestione Slot</title>
  <style>
    body { background:#e0f7fa; font-family:'Poppins',sans-serif; margin:0; padding:0; color:#006064 }
    .calendar { display:flex; flex-wrap:wrap; gap:20px; padding:20px }
    .day { background:#b2ebf2; padding:10px; border-radius:8px; flex:1 1 150px }
    .day h3 { margin:0 0 10px 0; }
    .slot-time {
      background:#c8e6c9; border-radius:4px; padding:4px 8px;
      display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;
      cursor:pointer;
    }
    .slot-time.occupied { background:#ffcdd2; }
    .slot-time button {
      background:none; border:none; cursor:pointer; font-size:1.1rem;
    }

    /* Modal */
    .modal {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.3); display:flex;
      justify-content:center; align-items:center;
      opacity:0; pointer-events:none; transition:opacity 0.2s;
    }
    .modal.active {
      opacity:1; pointer-events:auto;
    }
    .modal-content {
      background:#ffffff; padding:20px; border-radius:8px;
      max-width:400px; width:90%; position:relative;
    }
    .modal-content h2 { margin-top:0; }
    .close-btn {
      position:absolute; top:10px; right:10px;
      background:none; border:none; font-size:1.2rem; cursor:pointer;
    }
  </style>
</head>
<body>

  <div class="calendar" id="calendar"></div>

  <!-- Modal Dettaglio -->
  <div class="modal" id="detail-modal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal()">‚úñÔ∏è</button>
      <h2>Dettaglio Slot</h2>
      <div id="modal-details"></div>
    </div>
  </div>

  <script>
    // Simulazione dati Firebase
    const slotData = {
      "2025-05-02": [
        { ora: "08:00", visibile: true, occupato: true, utente: "Mario Rossi" },
        { ora: "09:00", visibile: false, occupato: false },
        { ora: "10:00", visibile: true, occupato: false }
      ],
      "2025-05-03": [
        { ora: "07:00", visibile: true, occupato: true, utente: "Luca Bianchi" },
        { ora: "08:00", visibile: true, occupato: false }
      ]
    };

    const calendarEl = document.getElementById("calendar");

    function renderCalendar() {
      calendarEl.innerHTML = "";
      for (const [date, slots] of Object.entries(slotData)) {
        const dayEl = document.createElement("div");
        dayEl.className = "day";
        const d = new Date(date);
        dayEl.innerHTML = `<h3>${d.toLocaleDateString("it-IT", { weekday: "long", day: "2-digit", month: "long" })}</h3>`;

        slots.forEach((slot, idx) => {
          const slotEl = document.createElement("div");
          slotEl.className = "slot-time";
          if (slot.occupato) slotEl.classList.add("occupied");

          const timeText = document.createElement("span");
          timeText.textContent = slot.ora;

          // Visibilit√† toggle
          const eyeBtn = document.createElement("button");
          eyeBtn.textContent = slot.visibile ? "üëÅÔ∏è" : "üôà";
          eyeBtn.onclick = (e) => {
            e.stopPropagation();
            slot.visibile = !slot.visibile;
            renderCalendar();
          };

          // Cancella slot
          const trashBtn = document.createElement("button");
          trashBtn.textContent = "üóëÔ∏è";
          trashBtn.onclick = (e) => {
            e.stopPropagation();
            slotData[date].splice(idx, 1);
            renderCalendar();
          };

          slotEl.appendChild(timeText);
          slotEl.appendChild(eyeBtn);
          slotEl.appendChild(trashBtn);

          // Click per aprire dettaglio se occupato
          slotEl.onclick = () => {
            if (slot.occupato) showModal(slot, date);
          };

          dayEl.appendChild(slotEl);
        });

        calendarEl.appendChild(dayEl);
      }
    }

    function showModal(slot, date) {
      const modal = document.getElementById("detail-modal");
      const content = document.getElementById("modal-details");
      content.innerHTML = `
        <p><strong>Data:</strong> ${date}</p>
        <p><strong>Ora:</strong> ${slot.ora}</p>
        <p><strong>Occupato:</strong> ${slot.occupato ? "S√¨" : "No"}</p>
        ${slot.utente ? `<p><strong>Utente:</strong> ${slot.utente}</p>` : ""}
      `;
      modal.classList.add("active");
    }

    function closeModal() {
      document.getElementById("detail-modal").classList.remove("active");
    }

    renderCalendar();
  </script>
</body>
</html>
